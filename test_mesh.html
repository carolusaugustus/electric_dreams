<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Diagn√≥stico Phaser - Test Completo</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.90.0/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
      background-color: #222;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    
    #debug-info {
      background: #333;
      color: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      max-width: 600px;
    }
    
    #game-container {
      border: 2px solid #555;
      display: inline-block;
    }
    
    .status {
      padding: 5px;
      margin: 2px 0;
      border-radius: 3px;
    }
    
    .success { background: #0a5d0a; }
    .error { background: #5d0a0a; }
    .warning { background: #5d4a0a; }
    .info { background: #0a2d5d; }
  </style>
</head>
<body>

<div id="debug-info">
  <h2>üîç Diagn√≥stico de Phaser</h2>
  <div id="status-list">
    <div class="status info">Iniciando diagn√≥stico...</div>
  </div>
</div>

<div id="game-container"></div>

<script>
// Sistema de debug
const DEBUG = {
  log: function(message, type = 'info') {
    const statusList = document.getElementById('status-list');
    const div = document.createElement('div');
    div.className = `status ${type}`;
    div.textContent = message;
    statusList.appendChild(div);
    console.log(`[${type.toUpperCase()}] ${message}`);
  }
};

DEBUG.log('üöÄ Iniciando sistema de diagn√≥stico');

class TestScene extends Phaser.Scene {
    constructor() {
        super('TestScene');
        DEBUG.log('‚úÖ Escena creada correctamente', 'success');
    }

    preload() {
        DEBUG.log('üì• Iniciando carga de recursos');
        
        // Test 1: Crear una imagen simple en c√≥digo
        this.load.image('test_square', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVQIHWPY9+8fAzYwirkTm38U80mxBwwAAFAQBgFD+LqYAAAAAElFTkSuQmCC');
        
        // Test 2: Intentar cargar tu imagen
        this.load.image('blink1', 'assets/blink_1.png');
        
        // Eventos de carga
        this.load.on('filecomplete', (key) => {
            DEBUG.log(`‚úÖ Archivo cargado: ${key}`, 'success');
        });
        
        this.load.on('loaderror', (file) => {
            DEBUG.log(`‚ùå Error cargando: ${file.key} - ${file.src}`, 'error');
        });
        
        this.load.on('complete', () => {
            DEBUG.log('üì¶ Carga completada', 'success');
        });
    }

    create() {
        DEBUG.log('üé® Iniciando creaci√≥n de objetos');
        
        // Test 1: Verificar que Phaser funciona b√°sicamente
        this.add.text(20, 20, '¬°Phaser funciona!', {
            fontSize: '24px',
            fill: '#00ff00'
        });
        DEBUG.log('‚úÖ Texto creado correctamente', 'success');
        
        // Test 2: Crear un rect√°ngulo simple
        const rect = this.add.rectangle(100, 100, 50, 50, 0xff0000);
        DEBUG.log('‚úÖ Rect√°ngulo creado correctamente', 'success');
        
        // Test 3: Verificar si la imagen de test carga
        if (this.textures.exists('test_square')) {
            const testImg = this.add.image(200, 100, 'test_square');
            testImg.setScale(20); // Hacer m√°s grande el pixel
            DEBUG.log('‚úÖ Imagen de test mostrada', 'success');
        } else {
            DEBUG.log('‚ùå Imagen de test no encontrada', 'error');
        }
        
        // Test 4: Verificar tu imagen
        if (this.textures.exists('blink1')) {
            const yourImg = this.add.image(300, 100, 'blink1');
            DEBUG.log('‚úÖ Tu imagen (blink1) cargada correctamente', 'success');
            
            // Test 5: Intentar crear un mesh b√°sico
            this.testBasicMesh();
        } else {
            DEBUG.log('‚ùå Tu imagen (blink1) no se pudo cargar', 'error');
            DEBUG.log('‚ö†Ô∏è Creando mesh con imagen de test', 'warning');
            this.testBasicMesh('test_square');
        }
        
        // Test 6: Informaci√≥n del sistema
        DEBUG.log(`üìä Renderer: ${this.sys.game.renderer.type === 0 ? 'Canvas' : 'WebGL'}`, 'info');
        DEBUG.log(`üìä Versi√≥n Phaser: ${Phaser.VERSION}`, 'info');
    }
    
    testBasicMesh(textureKey = 'blink1') {
        DEBUG.log(`üîß Intentando crear mesh con: ${textureKey}`, 'info');
        
        try {
            // Crear mesh b√°sico SIN modificaciones
            const mesh = this.add.mesh(400, 200, textureKey);
            DEBUG.log('‚úÖ Mesh b√°sico creado', 'success');
            
            // Verificar propiedades del mesh
            DEBUG.log(`üìä Mesh vertices: ${mesh.vertices ? mesh.vertices.length : 'undefined'}`, 'info');
            DEBUG.log(`üìä Mesh visible: ${mesh.visible}`, 'info');
            DEBUG.log(`üìä Mesh activo: ${mesh.active}`, 'info');
            
            // Test 7: Intentar crear geometr√≠a personalizada
            this.testCustomMesh(textureKey);
            
        } catch (error) {
            DEBUG.log(`‚ùå Error creando mesh: ${error.message}`, 'error');
        }
    }
    /*
    testCustomMesh(textureKey) {
        DEBUG.log('üîß Intentando crear mesh con geometr√≠a personalizada', 'info');
        
        try {
            const customMesh = this.add.mesh(400, 300, textureKey);
            
            // Geometr√≠a simple de cuadrado
            const vertices = [-32, -32, 32, -32, 32, 32, -32, 32];
            const uvs = [0, 0, 1, 0, 1, 1, 0, 1];
            const indices = [0, 1, 2, 0, 2, 3];
            
            customMesh.addVertices(vertices, uvs, indices);
            DEBUG.log('‚úÖ Mesh personalizado creado', 'success');
            
            // Test 8: Intentar efecto trapezoidal
            this.testTrapezoidEffect(customMesh);
            
        } catch (error) {
            DEBUG.log(`‚ùå Error con mesh personalizado: ${error.message}`, 'error');
        }
    }
    */

    testCustomMesh(textureKey) {
        DEBUG.log('üîß Insertando sprite deformado en pantalla inclinada', 'info');

        try {
            const vertices = [
                561, 830,     // top-left
                777, 823,     // top-right
                609, 1046,    // bottom-left
                827, 1020     // bottom-right
            ];

            const uvs = [
                0, 0,  // top-left
                1, 0,  // top-right
                0, 1,  // bottom-left
                1, 1   // bottom-right
            ];

            const indices = [0, 1, 2, 2, 1, 3];

            const mesh = this.add.mesh(0, 0, textureKey, null, vertices, uvs, indices, false);

            DEBUG.log('‚úÖ Sprite del ojo deformado e insertado en pantalla', 'success');
        } catch (e) {
            DEBUG.log(`‚ùå Error creando mesh en pantalla: ${e.message}`, 'error');
        }
    }



    testTrapezoidEffect(mesh) {
        DEBUG.log('üîß Aplicando efecto trapezoidal', 'info');
        
        try {
            // Modificar v√©rtices superiores
            mesh.vertices[0] = -16; // Top-left x
            mesh.vertices[2] = 16;  // Top-right x
            mesh.dirty = true;
            
            DEBUG.log('‚úÖ Efecto trapezoidal aplicado', 'success');
            
        } catch (error) {
            DEBUG.log(`‚ùå Error aplicando efecto: ${error.message}`, 'error');
        }
    }
}

// Configuraci√≥n de Phaser con debug
const config = {
    type: Phaser.AUTO,
    width: 600,
    height: 400,
    parent: 'game-container',
    scene: TestScene,
    backgroundColor: '#444444',
    physics: {
        default: 'arcade'
    }
};

DEBUG.log('‚öôÔ∏è Configuraci√≥n de Phaser preparada');

try {
    const game = new Phaser.Game(config);
    DEBUG.log('üéÆ Juego iniciado correctamente', 'success');
} catch (error) {
    DEBUG.log(`‚ùå Error cr√≠tico iniciando Phaser: ${error.message}`, 'error');
}
</script>

</body>
</html>